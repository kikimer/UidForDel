Удаление большого количества объектов без блокировки информационной базы 1С.

1. В базе 1С открывается обработка ВыгрузкаСсылкок.epf и запускается выгрузка данных. В настройках указывается путь к каталогу выгрузки и максимальный размер файла выгрузки. При прохождении предела максимального размера, файл записывается на диск. По окончанию выгрузки все части файлов сливаются в один. Эти действия экономят память. Обработка очень бережно к ней относится. Все данные получаются с использованием запросов и отсутствуют прямые обращения к реквизитам объектов. В результате отсутствует безграничный рост кеша. Для ускорения работы частые конкатенации строк заменены на обращение к объекту записьXML.ЗаписатьБезОбработки().

2. Запуск программы поиска удаляемых объектов UidForDel.jar. 
java Xmx8g -jar UidForDel.jar [каталогВыгрузки]
можно опустить параметр каталог выгрузки. В этом случае каталогом выгрузки будет считаться текущий катало
г. Xmx: допустимый размер памяти следует исходить из размера каталога с выгрузкой +необольой запас. Весь текст из выгруженных файлов будет загружен в память! После выполнения создастся файл result.txt. 

3. Снова запускается обработка ВыгрузкаСсылок.epf. В указанном каталоге должен находиться файл result.txt
. Запускается удаление объектов. Так как поиск ссылок не выполняется - удаление происходит быстро и не бл
окирует работу пользователей. В настройках можно указать элементы метаданных, которые следует удалять. 

ПРИМЕЧАНИЕ: В некоторых конфигурациях есть объекты, которые, несмотря на пометку на удаление и отсутствие ссылок на них, нельзя удалять. Они сами содержат ссылку и её необходимо проверять. В качестве примера пр
иведу счета фактуры в конфигурации бухгалтерия 3.0. Они хранят ссылку на документ-основание и они должны
оставаться в базе пока их документ-основание не удален. Для таких видов объектов созданно соответствие сСкрытыеЗависимости. Оно заполняется в начале процедуры ВыгрузитьСсылки() модуля обработки. Ключ соответств
ует метаданными со скрытыми зависимостями, а значение содержит имя реквизиты, хранящего внешнюю зависимос
ть.

ПРИМЕЧАНИЕ 2: Иногда надо удалить некоторые виды справочников, а остальные оставить. Допустим если в спра
вочниках хранятся чеки. В этом случае можно снять флаг удаления справочников, а в массив мУдаляемыхНезависимоОтНастроек добавить имя метаданных. Массив заполняется в начале функциии УдалитьСсылки модуля обработ
ки.
~                                                
